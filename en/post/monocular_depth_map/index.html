<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Monocular Depth Map - B. Hudyma Logs</title>
  <meta name="description" content="Generate a depth map from a monocular video">
  <meta name="author" content="Baptiste Hudyma"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "B. Hudyma Logs",
    
    "url": "https:\/\/BaptisteHudyma.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/BaptisteHudyma.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/BaptisteHudyma.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/BaptisteHudyma.github.io\/en\/post\/monocular_depth_map\/",
          "name": "Monocular depth map"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Baptiste Hudyma"
  },
  "headline": "Monocular Depth Map",
  "description" : "Use a video taken by a single camera to estimate the depth of objects in an image. A small dip in the world of epipolar geometry and key points analysis.\n",
  "inLanguage" : "en",
  "wordCount":  1314 ,
  "datePublished" : "2021-01-24T00:00:00",
  "dateModified" : "2021-01-24T00:00:00",
  "image" : "https:\/\/BaptisteHudyma.github.io\/img\/github_profile.jpg",
  "keywords" : [ "Computer vision, Cpp, OpenCV, Depth map, rgb-d" ],
  "mainEntityOfPage" : "https:\/\/BaptisteHudyma.github.io\/en\/post\/monocular_depth_map\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/BaptisteHudyma.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/BaptisteHudyma.github.io\/img\/github_profile.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Monocular Depth Map" />
<meta property="og:description" content="Generate a depth map from a monocular video">
<meta property="og:image" content="https://BaptisteHudyma.github.io/img/github_profile.jpg" />
<meta property="og:url" content="https://BaptisteHudyma.github.io/en/post/monocular_depth_map/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="B. Hudyma Logs" />

  <meta name="twitter:title" content="Monocular Depth Map" />
  <meta name="twitter:description" content="Generate a depth map from a monocular video">
  <meta name="twitter:image" content="https://BaptisteHudyma.github.io/img/github_profile.jpg" />
  <meta name="twitter:card" content="summary" />
  <link href='https://BaptisteHudyma.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.80.0" />
  <link rel="alternate" href="https://BaptisteHudyma.github.io/en/index.xml" type="application/rss+xml" title="B. Hudyma Logs"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-189718074-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://BaptisteHudyma.github.io/en/">B. Hudyma Logs</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Posts" href="/en/post">Posts</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/en/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About me" href="/en/page/about">About me</a>
            </li>
          
        

        
          
            <li>
              
                
              
                
                  <a href="/fr" lang="fr">fr</a>
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="B. Hudyma Logs" href="https://BaptisteHudyma.github.io/en/">
            <img class="avatar-img" src="https://BaptisteHudyma.github.io/img/github_profile.jpg" alt="B. Hudyma Logs" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Monocular Depth Map</h1>
              
              
              
                
                  <h2 class="post-subheading">Generate a depth map from a monocular video</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 24, 2021
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1314&nbsp;words
  
  
  &nbsp;&bull;&nbsp;Other languages: <a href="https://BaptisteHudyma.github.io/post/monocular_depth_map/" lang="fr">fr</a>
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


<div class="js-toggle-wrapper">
    <div class="js-toggle">
        <div class="js-toggle-track">
            <div class="js-toggle-track-check">
                <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
            </div>
            <div class="js-toggle-track-x">
                <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
            </div>
        </div>
        <div class="js-toggle-thumb"></div>
        <input class="js-toggle-screenreader-only" type="checkbox" aria-label="Switch between Dark and Light mode">
    </div>
</div>



<style>

 

.js-toggle-wrapper {
    display: table;
    margin: 0 auto;
}

.js-toggle {
    touch-action: pan-x;
    display: inline-block;
    position: relative;
    cursor: pointer;
    background-color: transparent;
    border: 0;
    padding: 0;
    -webkit-touch-callout: none;
    user-select: none;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    -webkit-tap-highlight-color: transparent;
  }

  .js-toggle-screenreader-only {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  .js-toggle-track {
    width: 50px;
    height: 24px;
    padding: 0;
    border-radius: 30px;
    background-color: hsl(222, 14%, 7%);
    transition: all 0.2s ease;
  }

  .js-toggle-track-check {
    position: absolute;
    width: 17px;
    height: 17px;
    left: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 0;
    transition: opacity 0.25s ease;
  }

  .js-toggle--checked .js-toggle-track-check {
    opacity: 1;
    transition: opacity 0.25s ease;
  }

  .js-toggle-track-x {
    position: absolute;
    width: 17px;
    height: 17px;
    right: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 1;
    transition: opacity 0.25s ease;
  }

  .js-toggle--checked .js-toggle-track-x {
    opacity: 0;
  }

  .js-toggle-thumb {
    position: absolute;
    top: 1px;
    left: 1px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background-color: #fafafa;
    box-sizing: border-box;
    transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1) 0ms;
    transform: translateX(0);
  }

  .js-toggle--checked .js-toggle-thumb {
    transform: translateX(26px);
    border-color: #19ab27;
  }

  .js-toggle--focus .js-toggle-thumb {
    box-shadow: 0px 0px 2px 3px rgb(255, 167, 196);
  }

  .js-toggle:active .js-toggle-thumb {
    box-shadow: 0px 0px 5px 5px rgb(255, 167, 196);
  }
</style>

<script>
    
    let systemInitiatedDark = window.matchMedia("(prefers-color-scheme: dark)");
    
    
    let theme = sessionStorage.getItem('theme');
    var switcher = document.getElementsByClassName('js-toggle')[0];
    
    
    if (systemInitiatedDark.matches) {
    }
    else{
        switcher.classList.toggle('js-toggle--checked');
    }
    
    
    function prefersColorTest(systemInitiatedDark) {
        var switcher = document.getElementsByClassName('js-toggle')[0];
        switcher.classList.toggle('js-toggle--checked');
        if (systemInitiatedDark.matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            
            sessionStorage.setItem('theme', '');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', '');
        }
    }
    systemInitiatedDark.addListener(prefersColorTest);
    
    switcher.addEventListener("click", function () {
        
        let theme = sessionStorage.getItem('theme');
        this.classList.add('js-toggle--focus');
        this.classList.toggle('js-toggle--checked');
        
        if (theme === "dark") {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', 'light');
            
        }	else if (theme === "light") {
            document.documentElement.setAttribute('data-theme', 'dark');
            sessionStorage.setItem('theme', 'dark');
            
        } else if (systemInitiatedDark.matches) {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', 'light');
            
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
            sessionStorage.setItem('theme', 'dark');
        }
        
    });
    
    if (theme === "dark") {
        document.documentElement.setAttribute('data-theme', 'dark');
        sessionStorage.setItem('theme', 'dark');
        switcher.classList.add('js-toggle--checked');
    } else if (theme === "light") {
        document.documentElement.setAttribute('data-theme', 'light');
        sessionStorage.setItem('theme', 'light');
        switcher.classList.add('js-toggle--unchecked');
    }
</script>








    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Use a video taken by a single camera to estimate the depth of objects in an image.
A small dip in the world of epipolar geometry and key points analysis.</p>
<h1 id="depths-maps-">Depths maps ?</h1>
<p>Usually, if you want to give your vision system a sense of depth, you have a few options :</p>
<ul>
<li>Stereo vision: Use two cameras and a bit a <em>smart</em></li>
<li>Monocular vision: Use one camera and a bit more <em><strong>smart</strong></em></li>
<li>Use a RGB-D Camera.</li>
</ul>
<p>Stereo vision is great, but computationally intensive, monocular vision can work with machine learning or extending the system to stereo (more on that later), RGB-D is super reliable but works best inside and only at close range.</p>
<p>Well, I don&rsquo;t have two cameras, but what I got is the best kind of cams: an RGB-D one (I absolutely love depth cameras) !
This cam is great, but the depth estimation depends exclusively on an infrared projection.
The estimated depth is disturbed by a few factors, including (but not limited to):</p>
<ul>
<li>Dark surfaces</li>
<li>Reflective surfaces</li>
<li>Small textures (ie: Carpet)</li>
<li>Sun light</li>
<li>Occlusion</li>
<li>Distance (4-5 meters)</li>
</ul>
<p>Exemple of an incomplete depth map (dataset: <em>yoga_mat</em> from CAPE):
<img src="/static/depthmap/rgb_depth_holes.png" alt="depth Holes Holes Holes"></p>
<p>You can observe holes from depth discontinuity/occlusion (left of the cylinder), and holes from transformation at the top and right of the depth image.
The <em>lines</em> of holes in the ground are due to the discrete nature of the depth measurement.</p>
<p>There is a good number of methods to fill those holes (<a href="https://github.com/pedropro/OMG_Depth_Fusion">Gaussian fusion</a>, Machine learning, &hellip;), but I wanted to take my shot at it with a simple idea : What about merging the informations of the depth map with another depth map, less accurate but more reliable ?</p>
<p>Well I have a RGB cam tied to my depth camera (has the name &ldquo;RGB-D&rdquo; implies), lets try to get a depth estimation from the RGB cam.</p>
<p>The first step is to get the monocular depth map.
<strong>Let&rsquo;s get into it.</strong></p>
<h1 id="monocular-depth-map">Monocular depth map</h1>
<p>Well, how do you make a depth estimation from a single image ?
There is not a lot of answers, most of them will scream &ldquo;neural networks&rdquo; !</p>
<p>But as our Mentor Master Yoda said,
<img src="/static/rand/yoda.png" alt="There is another">
Thanks Yoda !</p>
<p>We can try to use two following images in a video as two images taken from a stereo system, while not knowing the transformation between the two images.
And you know what ? We can deduce this transformation pretty easily.</p>
<p>The key to this whole story as a name : <strong>Epipolar geometry</strong>.
I wont get into the details and try to approximate the whole operation in one sentence: epipolar geometry estimates a transformation of one image into the other one.</p>
<p>The logic behind this operation is pretty simple:</p>
<ul>
<li>get the key points of the two images</li>
<li>Match the key points, remove outliers</li>
<li>Estimate the transformation of the points from the first image to get the points of the other one.</li>
<li>Estimate the disparity map (sort of depth map)</li>
</ul>
<p>All of those operations can be done with OpenCV.</p>
<h3 id="key-points">Key points</h3>
<p>To find the key points, I used the OpenCV SURF feature detector.
Those key points can than be matched using the OpenCV DescriptorMatcher, using FLANN.</p>
<p><img src="/static/depthmap/matched_keypoints.png" alt="Matched keypoints"></p>
<p>We than get matched pairs, that we can prune based on their distances to the target point, and obtain a clean list of matched points.</p>
<p>In the above image, we can see at least two outliers (key points wrongly matched).
Those outliers will be eliminated by the distance check mentioned earlier, or will be removed by the next step.</p>
<p><strong>A quick note</strong>: Epipolar projection of the two images will deform them so two matched keypoints will be placed on the same straight line on the two images.
Here, it almost look like it&rsquo;s already the case: it&rsquo;s due to the proximity of the two images in time.
A better visualization (and in depth explanations !) can be seen on the <a href="https://docs.opencv.org/master/da/de9/tutorial_py_epipolar_geometry.html">OpenCV page</a>.</p>
<h3 id="fundamental-matrix">Fundamental Matrix</h3>
<p>OpenCV will also help use with the &ldquo;Estimate the transformation&rdquo; step.
Calling the function <code>cv::findHomography</code> with the matched points pairs will return a fundamental matrice, that we can use to warp the second image with (<code>cv::warpPerspective</code>).
I used <code>findHomography</code> with a <code>cv::FM_RANSAC</code> parameter.</p>
<p>RANSAC is a great method, that I advise you to take a look at.
It allows (in this case) to find the optimal transformation matrix without being affected by outliers.
We can also get back the in/outliers list (as a vector) to further prune the points of interest (We don&rsquo;t really need them here).</p>
<p>Ransac can be use for a lot more use cases of course !
I also used it to extract cylinders from a plane graph, like CAPE did.</p>
<h3 id="stereo-matching">Stereo matching</h3>
<p>The last trick to obtain the depth map is as simple as the previous one.
We call once more to our glorious OpenCV, with the class <code>StereoSGBM</code>.
This class should be use with a stereo setup, but now that our two images are projected correctly, nobody will stop us from pretending they are from a stereo setup.</p>
<p>Well, the result is not too bad (after a lot of parameters tuning)</p>
<p><img src="/static/depthmap/rgb_monodepth.png" alt="Simulated depth map"></p>
<p>There are a few holes, some discontinuities in the depth estimations and some aberrations in the estimations at the top of the cylinder, but overall it&rsquo;s pretty good.</p>
<p><strong>I selected a clean image for demonstration purposes but most of them are still super noisy</strong>.</p>
<p>Just for the kicks, here is the raw version, with default parameters :</p>
<p><img src="/static/depthmap/rgb_monodepth_default.png" alt="Ugly mess map"></p>
<p>We can clearly see that some flat textures are displayed as depth features (like the QR codes).
This is also the case in the top image, but the difference is less visible.</p>
<h3 id="filtering-step">Filtering step</h3>
<p>The last step for now is to filter a bit our estimation, to obtain a cleaner depth map.
For this purpose, I use a <code>DisparityWLSDFilter</code> from <code>cv::ximgproc</code>, normally use with a true stereo system.</p>
<p>The final result can be observed below, with the monocular generated depth map to the left, and the depth map from the depth camera to the right for comparison purposes :</p>
<p><img src="/static/depthmap/depth_monodepth.png" alt="Filtered result"></p>
<p>Overall, the final result is pretty good !
Better than expected at least.</p>
<p>Compared to the raw depth map, the monocular shows less holes and errors (they are supposed to be exactly the same).
Some points needs to be addressed :</p>
<ul>
<li>The final monocular depth map does not have any units (meters, mm, &hellip;) and thus as no use for me in this state</li>
<li>The filtering process &ldquo;leaked&rdquo; some depth informations on the side of the cylinder (darker background)</li>
<li>The texture of the QR codes can still be seen on the ground, and create a depth error.</li>
<li>the top of the cylinder is displayed has being closer to the observer than the ground under it, and we can see that it is wrong (from the true depth image).</li>
</ul>
<p>Another important point, and I did not mention it at all for this entire process: Monocular depth map cannot be as good as a stereo depth map.
Stereo generated depth map are much more reliable and precise.
They also give us a real measurable depth, as the distance between the two cameras is precisely known.</p>
<p>The quality of depth estimation depends a lot on this distance: basic trigonometry indicates that the depth estimation will be OK only in a comparable scale as this distance.
Here, my &ldquo;two&rdquo; cameras are each separated by a very small time/distance, has they are two following frames of a video.
The quality of the depth estimation will only be valuable for short distances, experimentally at 2 meters in my case.</p>
<p>But even with those imperfections, this monocular depth map can be use to extract useful informations, and that&rsquo;s what I will do in the next part : Depth map Merging.</p>
<h1 id="little-bonus">Little Bonus</h1>
<p>Here is the result of the error map, straight out of the filter.
As expected, errors are for the most part located at the depth discontinuity points.</p>
<p><img src="/static/depthmap/monodepth_error.png" alt="Filtered result"></p>

        
          <div class="blog-tags">
            
              <a href="https://BaptisteHudyma.github.io/en/tags/computer-vision/">Computer vision</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/en/tags/cpp/">Cpp</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/en/tags/opencv/">OpenCV</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/en/tags/depth-map/">Depth map</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/en/tags/rgb-d/">rgb-d</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f&amp;text=Monocular%20Depth%20Map&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f&amp;title=Monocular%20Depth%20Map" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f&amp;title=Monocular%20Depth%20Map" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f&amp;title=Monocular%20Depth%20Map" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fBaptisteHudyma.github.io%2fen%2fpost%2fmonocular_depth_map%2f&amp;description=Monocular%20Depth%20Map" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/en/post/ppc_intro/">Constraint Programming</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://BaptisteHudyma.github.io/en/post/ppc_intro/" data-toggle="tooltip" data-placement="top" title="Constraint Programming">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://BaptisteHudyma.github.io/en/post/depth_map_merging/" data-toggle="tooltip" data-placement="top" title="Depth Map Merging">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:bapt.hudyma95650@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/BaptisteHudyma" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://gitlab.com/BaptHdm" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/baptiste-hudyma" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Baptiste Hudyma
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2021
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://BaptisteHudyma.github.io/en/">B. Hudyma Logs</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.80.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://BaptisteHudyma.github.io/js/main.js"></script>
<script src="https://BaptisteHudyma.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://BaptisteHudyma.github.io/js/load-photoswipe.js"></script>









    
  </body>
</html>

