<!DOCTYPE html>
<html lang="fr" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>De CAPE et d&#39;Opés - HUB Logs</title>
  <meta name="description" content="Corriger et optimiser le code d&#39;un papier">
  <meta name="author" content="Baptiste Hudyma"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "HUB Logs",
    
    "url": "https:\/\/BaptisteHudyma.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/BaptisteHudyma.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/BaptisteHudyma.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/BaptisteHudyma.github.io\/post\/de_cape_et_d_opes\/",
          "name": "De cape et d\u0027 opés"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Baptiste Hudyma"
  },
  "headline": "De CAPE et d\u0027Opés",
  "description" : "CAPE (Cylinder And Plane Extraction) est une méthode extrêmement efficace d\u0026rsquo;extraction de plans et cylindres dans des images RGB-D, basée sur une méthode AHC. Malgré l\u0026rsquo;efficacité de cette méthode, l\u0026rsquo;implémentation C\u002b\u002b du papier présente de nombreux défauts.\nDans ce post, je vais expliquer comment j\u0026rsquo;ai réparé la plupart de ces problèmes.\n",
  "inLanguage" : "fr",
  "wordCount":  1203 ,
  "datePublished" : "2021-01-11T00:00:00",
  "dateModified" : "2021-01-11T00:00:00",
  "image" : "https:\/\/BaptisteHudyma.github.io\/img\/github_profile.jpg",
  "keywords" : [ "Cpp, RGB-D, Optimisation, Paper" ],
  "mainEntityOfPage" : "https:\/\/BaptisteHudyma.github.io\/post\/de_cape_et_d_opes\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/BaptisteHudyma.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/BaptisteHudyma.github.io\/img\/github_profile.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="De CAPE et d&#39;Opés" />
<meta property="og:description" content="Corriger et optimiser le code d&#39;un papier">
<meta property="og:image" content="https://BaptisteHudyma.github.io/img/github_profile.jpg" />
<meta property="og:url" content="https://BaptisteHudyma.github.io/post/de_cape_et_d_opes/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="HUB Logs" />

  <meta name="twitter:title" content="De CAPE et d&#39;Opés" />
  <meta name="twitter:description" content="Corriger et optimiser le code d&#39;un papier">
  <meta name="twitter:image" content="https://BaptisteHudyma.github.io/img/github_profile.jpg" />
  <meta name="twitter:card" content="summary" />
  <link href='https://BaptisteHudyma.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.120.1">
  <link rel="alternate" href="https://BaptisteHudyma.github.io/index.xml" type="application/rss+xml" title="HUB Logs"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/syntax.css" />
  <link rel="stylesheet" href="https://BaptisteHudyma.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-189718074-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://BaptisteHudyma.github.io">HUB Logs 
      </a>
      <a class="navbar-brand">
      <div class="js-toggle-wrapper">
    <div class="js-toggle">
        <div class="js-toggle-track">
            <div class="js-toggle-track-check">
                <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
            </div>
            <div class="js-toggle-track-x">
                <img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
            </div>
        </div>
        <div class="js-toggle-thumb"></div>
        <input class="js-toggle-screenreader-only" type="checkbox" aria-label="Switch between Dark and Light mode">
    </div>
</div>



<style>

 

.js-toggle-wrapper {
    display: table;
    margin: 0 auto;
}

.js-toggle {
    touch-action: pan-x;
    display: inline-block;
    position: relative;
    cursor: pointer;
    background-color: transparent;
    border: 0;
    padding: 0;
    -webkit-touch-callout: none;
    user-select: none;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    -webkit-tap-highlight-color: transparent;
  }

  .js-toggle-screenreader-only {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  .js-toggle-track {
    width: 50px;
    height: 24px;
    padding: 0;
    border-radius: 30px;
    background-color: hsl(222, 14%, 7%);
    transition: all 0.2s ease;
  }

  .js-toggle-track-check {
    position: absolute;
    width: 17px;
    height: 17px;
    left: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 0;
    transition: opacity 0.25s ease;
  }

  .js-toggle--checked .js-toggle-track-check {
    opacity: 1;
    transition: opacity 0.25s ease;
  }

  .js-toggle-track-x {
    position: absolute;
    width: 17px;
    height: 17px;
    right: 5px;
    top: 0px;
    bottom: 0px;
    margin-top: auto;
    margin-bottom: auto;
    line-height: 0;
    opacity: 1;
    transition: opacity 0.25s ease;
  }

  .js-toggle--checked .js-toggle-track-x {
    opacity: 0;
  }

  .js-toggle-thumb {
    position: absolute;
    top: 1px;
    left: 1px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background-color: #fafafa;
    box-sizing: border-box;
    transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1) 0ms;
    transform: translateX(0);
  }

  .js-toggle--checked .js-toggle-thumb {
    transform: translateX(26px);
    border-color: #19ab27;
  }

  .js-toggle--focus .js-toggle-thumb {
    box-shadow: 0px 0px 2px 3px rgb(255, 167, 196);
  }

  .js-toggle:active .js-toggle-thumb {
    box-shadow: 0px 0px 5px 5px rgb(255, 167, 196);
  }
</style>

<script>
    
    let systemInitiatedDark = window.matchMedia("(prefers-color-scheme: dark)");
    
    
    let theme = sessionStorage.getItem('theme');
    var switcher = document.getElementsByClassName('js-toggle')[0];
    
    
    if (systemInitiatedDark.matches) {
    }
    else{
        switcher.classList.toggle('js-toggle--checked');
    }
    
    
    function prefersColorTest(systemInitiatedDark) {
        var switcher = document.getElementsByClassName('js-toggle')[0];
        switcher.classList.toggle('js-toggle--checked');
        if (systemInitiatedDark.matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            
            sessionStorage.setItem('theme', '');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', '');
        }
    }
    systemInitiatedDark.addListener(prefersColorTest);
    
    switcher.addEventListener("click", function () {
        
        let theme = sessionStorage.getItem('theme');
        
        this.classList.toggle('js-toggle--checked');
        
        if (theme === "dark") {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', 'light');
            
        }	else if (theme === "light") {
            document.documentElement.setAttribute('data-theme', 'dark');
            sessionStorage.setItem('theme', 'dark');
            
        } else if (systemInitiatedDark.matches) {
            document.documentElement.setAttribute('data-theme', 'light');
            sessionStorage.setItem('theme', 'light');
            
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
            sessionStorage.setItem('theme', 'dark');
        }
        
    });
    
    if (theme === "dark") {
        document.documentElement.setAttribute('data-theme', 'dark');
        sessionStorage.setItem('theme', 'dark');
        switcher.classList.add('js-toggle--checked');
    } else if (theme === "light") {
        document.documentElement.setAttribute('data-theme', 'light');
        sessionStorage.setItem('theme', 'light');
        switcher.classList.add('js-toggle--unchecked');
    }
</script>





      </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Posts" href="/post">Posts</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About me" href="/page/about">About me</a>
            </li>
          
        

    

        
          
            <li>
              
                
                  <a href="/en" lang="en">en</a>
                
              
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="HUB Logs" href="https://BaptisteHudyma.github.io">
            <img class="avatar-img" src="https://BaptisteHudyma.github.io/img/github_profile.jpg" alt="HUB Logs" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>De CAPE et d&#39;Opés</h1>
              
              
              
                
                  <h2 class="post-subheading">Corriger et optimiser le code d&#39;un papier</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posté le January 11, 2021
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1203&nbsp;mots
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>





    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p><a href="https://arxiv.org/abs/1803.02380">CAPE (Cylinder And Plane Extraction)</a> est une méthode extrêmement efficace d&rsquo;extraction de plans et cylindres dans des images RGB-D, basée sur une méthode AHC.
Malgré l&rsquo;efficacité de cette méthode, l&rsquo;implémentation C++ du papier présente de nombreux défauts.</p>
<p>Dans ce post, je vais expliquer comment j&rsquo;ai réparé la plupart de ces problèmes.</p>
<p>CAPE est une méthode efficace, fiable et rapide (&lt; 4ms pour une image de 640 * 480 pixels), dont l&rsquo;idée est basée sur <a href="https://www.merl.com/research/license/PEAC">PEAC</a>.
CAPE améliore la méthode PEAC en accélérant la détection de plans, et en ajoutant une détection de cylindres par un algorithme RANSAC.
Si la méthode présentée dans le papier est très impressionnante, son <a href="https://github.com/pedropro/CAPE">implémentation</a> présente de nombreux défauts, notamment au niveau de la gestion de mémoire.</p>
<h1 id="petite-présentation-de-lahc">Petite présentation de l&rsquo;AHC</h1>
<p>AHC (Agglomerative hierarchical clustering) est une méthode introduite par PEAC en 2014, qui consiste a analyser les images RGB-D en les découpant en une grille de NxM rectangles.
Les pixels dans ces rectangles sont ensuite analysés individuellement pour déterminer s&rsquo;ils font partie d&rsquo;un plan 3D, et si c&rsquo;est le cas, utiliser la position relative de ces rectangles dans l&rsquo;image pour fusionner les plans proches et construire un graph de l&rsquo;ensemble des plans.</p>
<p>Cette méthode présente l&rsquo;avantage de traiter une image 3D comme une image 2D, et est donc bien plus rapide qu&rsquo;une analyse d&rsquo;un nuage de points.
Elle est cependant limitée en l&rsquo;état a l&rsquo;analyse d&rsquo;images RGB-D.</p>
<p>Lors de sa publication, PEAC était la méthode de détection de plan 3D la plus rapide (de loin), et présentant des performances équivalentes a l&rsquo;état de l&rsquo;art des algorithmes de détection de plans 3D.</p>
<h1 id="corriger-cape">Corriger CAPE</h1>
<p>L&rsquo;implémentation de CAPE, fournie par les auteurs, propose des performances impressionnantes de rapidité et fiabilité.
Elle est capable de gérer l&rsquo;étape de détection de plans en moins de 4 millisecondes, ce qui est plus que suffisant pour du temps réel.</p>
<p>Cependant, le code est mal organisé et présente de nombreux défauts d&rsquo;implémentation, notamment pour la gestion de mémoire et les copies de classes dans les <code>vector</code>.
Corriger ces erreurs améliore légèrement les performances de cette méthode.</p>
<p>Je ne vais pas préciser ici la correction des erreurs classiques comme l&rsquo;absence des <code>ifndef</code> dans les <code>.hpp</code>, ou l&rsquo;absence des <code>const</code> et <code>const&amp;</code> pour les paramètres en entrée des fonctions et classe.</p>
<h2 id="classe-cape">Classe <code>CAPE</code></h2>
<p><strong>Allocations inutiles</strong></p>
<p>Dans le constructeur, le <code>vector</code> Grid, contenant une liste de N pointeurs vers une classe (<code>PlaneSegment*</code>), est initialisé par une boucle qui le rempli de <code>nullptr</code> (utiliser la méthode <code>reserve</code> aurait été plus adapté).
Les pointeurs de <code>Grid</code> sont enduite réaffectés dans la fonction <code>process</code>, appelée pour chaque nouvelle image RGBD, via la ligne <code>Grid[id] = new PlaneSeg(....);</code>.
Utiliser <code>new</code> pour remplacer un <code>nullptr</code> est ok, mais au deuxième appel a la fonction <code>process</code>, on va surtout allouer une nouvelle zone mémoire sans désallouer l&rsquo;ancienne.
Une petite fuite de mémoire potentielle donc.</p>
<p>Mais une petite minute&hellip; <code>Grid</code> utilise la classe <code>vector</code> avec un nombre constant d&rsquo;éléments, mais n&rsquo;utilise jamais les propriétés de <code>vector</code>. Pourquoi utiliser un <code>vector</code> ?</p>
<p>Je l&rsquo;ai donc remplacé par un tableau de <code>unique_ptr</code> initialisé via un <code>new unique_ptr&lt;PlaneSegment&gt;[N]</code>, puis ajouté un constructeur basique a la classe <code>PlaneSegment</code>, appelée dans le constructeur, ainsi qu&rsquo;une fonction <code>init</code> pour éviter N allocations a chaque appel de la fonction <code>process</code>.
J&rsquo;ai également ajouté un destructeur a la classe <code>CAPE</code> pour libérer <code>Grid</code>.</p>
<p>Une fuite bouchée, une amélioration (minime) des performances en évitant N allocations par appel.</p>
<p><strong>Une réinitialisation évitable</strong></p>
<p>Dans la fonction <code>process</code>, appelée a chaque analyse d&rsquo;image, une variable <code>H</code> de la classe <code>Histogram</code> est alloué, contenant deux <code>vector</code> avec chacun une taille constante de 20 éléments.
Le fait de le déclarer dans le bloc de la fonction évite les fuites mémoires, mais nécessite de rajouter 40 allocations par appel a la fonction <code>process</code>.
J&rsquo;ai donc fait de <code>H</code> une variable membre de la classe <code>CAPE</code>, remplacé les <code>vector</code> de <code>Histogram</code> par des tableaux, puis ajouté a la fonction <code>initHistogram</code> un appel a <code>fill_n</code> pour initialiser les éléments de ces tableaux a 0.
Sans oublier bien sur un petit Destructeur pour désallouer ces tableaux.</p>
<p><strong>Une erreur d&rsquo;index</strong></p>
<p>La boucle <code>for</code> ligne 126 a pour but de chercher l&rsquo;index de la cellule avec l&rsquo;erreur minimum.
La valeur de <code>minMSE</code> est comparée a <code>Grid[seed_candidate]-&gt;MSE</code>, et si elle est supérieure, on lui affecte <code>min_MSE = Grid[i]-&gt;MSE;</code>.
J&rsquo;ai donc corrigé la sélection d&rsquo;index par <code>min_MSE = Grid[seed_candidate]-&gt;MSE;</code>.</p>
<p>J&rsquo;ai également modifié toutes les classes pour que les membres soient <code>private</code> et ajouté des fonctions get.</p>
<p><strong>Une copie en arrière-plan</strong></p>
<p><code>PlaneSeg new_ps = *Grid[seed_id];</code>.
À première vue, c&rsquo;est assez innocent.
Ce qui se passe en arrière-plan est un peu moins Innocent: c&rsquo;est un appel a un constructeur par copie.
Si on n&rsquo;a pas de constructeur par copie déclaré dans notre classe, le compilateur va en créer un par défaut, dont le comportement n&rsquo;est peut-être pas celui désiré.</p>
<p>Une bonne pratique pour éviter ce genre de copies par défaut est de déclarer le constructeur par défaut ainsi que l&rsquo;opérateur = en privé dans notre classe.
Le compilateur nous préviendra des copies à l&rsquo;avenir, avec une bonne erreur des familles.
Ajouter ces méthodes fait également sortir un autre message d&rsquo;erreur que je n&rsquo;avais pas vu venir : <code>vector.push_back(class)</code> appelle le constructeur par copie de la classe.</p>
<p>À mon avis, la meilleure manière de contourner ce comportement est d&rsquo;utiliser des vecteurs de pointeurs, notamment de <code>shared_ptr</code> dans ce cas précis.</p>
<p><strong>Une autre erreur d&rsquo;index</strong></p>
<p>Ligne 238, la distance au plan est calculée par le produit scalaire de la normale d&rsquo;un plan par la valeur <code>mean</code> d&rsquo;un autre plan.
Cependant, le premier terme <code>plane_segments[r].normal[0]</code> devrait être <code>plane_segments[plane_id].normal[0]</code>.</p>
<p>Pour éviter les erreurs de copier coller, j&rsquo;ai remplacé les tableaux <code>normal</code> et <code>mean</code> de la classe <code>PlaneSegment</code> par des <code>Eigen::Vector3d</code> afin d&rsquo;utiliser directement la fonction <code>Vector3d.dot(Vector3d)</code>.
Une autre méthode pour continuer d&rsquo;utiliser des tableaux de double aurait été de définir une fonction <code>double dot(const double&amp; vecA[3], const double&amp; vecB[3])</code> pour éviter le code redondant, ou encore de définir une fonction membre <code>getDistance</code> dans la classe <code>PlaneSegment</code>, qui a l&rsquo;avantage de ne pas utiliser de getter.</p>
<p><strong>Boucles redondante</strong></p>
<p>La boucle ligne 434 a 445 sert à copier le résultat de l&rsquo;analyse des cylindres dans le <code>vector</code> avec les cylindres finaux.
Son existence est justifiée pour une certaine clarté du code, mais une petite optimisation peut être réalisée en faisant la copie des résultats finaux dans la boucle précédente (vers la ligne 348).</p>
<p>De même, maintenant que nous avons remplacé <code>Grid</code> par un tableau fixe non réalloué a chaque appel de fonction, la boucle de 449 a 455 est également à éliminer.</p>
<p>Dans la fonction <code>getConnectedComponents</code>, une autre boucle peut être supprimée.
Il s&rsquo;agit de la double boucle de la ligne 476 a 480, qui rend la matrice <code>planes_association_matrix</code> symétrique.
Il suffit de copier directement les valeurs symétriques au niveau des lignes 471 et 472.</p>
<h2 id="résultat-des-courses">Résultat des courses</h2>
<p>j&rsquo;ai vérifié mon travail a l&rsquo;aide de <em>valgrind</em>, et j&rsquo;ai pu confirmer le rebouchage des fuites mémoire, avec une amélioration négligeable (de l&rsquo;ordre de la demi milliseconde) des performances sans incidence sur la sortie.
La prochaine étape consistera à chercher des pistes d&rsquo;amélioration de performances générales de l&rsquo;algo.</p>
<p>J&rsquo;ai profité de mes modifications pour ajouter des métriques d&rsquo;évaluation, inspirée de PEAC, a la place de certaines constantes.</p>

        
          <div class="blog-tags">
            
              <a href="https://BaptisteHudyma.github.io/tags/cpp/">Cpp</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/tags/rgb-d/">RGB-D</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/tags/optimisation/">Optimisation</a>&nbsp;
            
              <a href="https://BaptisteHudyma.github.io/tags/paper/">Paper</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f&amp;text=De%20CAPE%20et%20d%27Op%c3%a9s&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f&amp;title=De%20CAPE%20et%20d%27Op%c3%a9s" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f&amp;title=De%20CAPE%20et%20d%27Op%c3%a9s" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f&amp;title=De%20CAPE%20et%20d%27Op%c3%a9s" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fBaptisteHudyma.github.io%2fpost%2fde_cape_et_d_opes%2f&amp;description=De%20CAPE%20et%20d%27Op%c3%a9s" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">Voir également</h4>
                  <ul>
                
                
                    <li><a href="/post/slam_2/">SLAM - Parti 2</a></li>
                
                    <li><a href="/post/slam_1/">SLAM - Parti 1</a></li>
                
                    <li><a href="/post/monte_carlo_tree_p2/">Exploration de possibilités - Partie 2</a></li>
                
                    <li><a href="/post/monte_carlo_tree_p1/">Exploration de possibilités - Partie 1</a></li>
                
                    <li><a href="/post/depth_map_segmentation/">Segmentation de depth map</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://BaptisteHudyma.github.io/post/ppc_slam/" data-toggle="tooltip" data-placement="top" title="PPC SLAM">&larr; Post précédent</a>
            </li>
          
          
            <li class="next">
              <a href="https://BaptisteHudyma.github.io/post/monocular_depth_map/" data-toggle="tooltip" data-placement="top" title="Monocular Depth Map">Post suivant &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:bapt.hudyma95650@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/BaptisteHudyma" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://gitlab.com/BaptHdm" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/baptiste-hudyma" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Baptiste Hudyma
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2023
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://BaptisteHudyma.github.io">HUB Logs</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          Carbure avec <a href="https://gohugo.io">Hugo v0.120.1</a>&nbsp;&bull;&nbsp; Avec le Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapté de <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://BaptisteHudyma.github.io/js/main.js"></script>
<script src="https://BaptisteHudyma.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://BaptisteHudyma.github.io/js/load-photoswipe.js"></script>









    
  </body>
</html>

